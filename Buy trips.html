<script>
    document.addEventListener('DOMContentLoaded', function () {
        const nfcButton = document.getElementById('nfc-scan-button');
        const nfcStatus = document.getElementById('nfc-status');
        const serialNumberInput = document.getElementById('serial-number');

        // Check if the device supports NFC
        if ('NFCReader' in window) {
            nfcStatus.textContent = "NFC is supported on this device.";

            // Add click event listener for NFC scan button
            nfcButton.addEventListener('click', async function () {
                try {
                    const nfcReader = new NFCReader();
                    nfcReader.onreading = (event) => {
                        const nfcSerialNumber = event.serialNumber;
                        nfcStatus.textContent = "NFC Tag Scanned: " + nfcSerialNumber;
                        serialNumberInput.value = nfcSerialNumber; // Autofill the serial number input
                    };
                    await nfcReader.start();
                } catch (error) {
                    console.error("Error reading NFC:", error);
                    nfcStatus.textContent = "NFC scanning failed.";
                }
            });
        } else {
            nfcStatus.textContent = "NFC is not supported on this device.";
            nfcButton.disabled = true; // Disable the button if NFC is not supported
        }

        // Handle the form submission
        const form = document.getElementById('purchase-form');
        form.addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission

            // Get form data
            const tripQuantity = document.getElementById('tickets').value;
            const busTag = document.getElementById('bus-tag').value || serialNumberInput.value;
            const bankCard = document.getElementById('bank-card').value;
            const expiryDate = document.getElementById('expiry-date').value;
            const cvv = document.getElementById('cvv').value;

            // Validate and process the form data
            if (validateFormData(tripQuantity, busTag, bankCard, expiryDate, cvv)) {
                // Communicate with Firestore or perform other operations
                await sendDataToFirestore(tripQuantity, busTag, bankCard, expiryDate, cvv);
            }
        });

        // Function to validate form data
        function validateFormData(tripQuantity, busTag, bankCard, expiryDate, cvv) {
            return tripQuantity && busTag && bankCard && expiryDate && cvv; // Basic validation logic
        }

        // Function to send data to Firestore
        async function sendDataToFirestore(tripQuantity, busTag, bankCard, expiryDate, cvv) {
            try {
                const response = await fetch('https://your-firestore-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tripQuantity,
                        busTag,
                        bankCard,
                        expiryDate,
                        cvv
                    }),
                });
                const data = await response.json();
                console.log('Data sent to Firestore:', data);
            } catch (error) {
                console.error('Error sending data to Firestore:', error);
            }
        }
    });
</script>
